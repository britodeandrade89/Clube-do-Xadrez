<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Club App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.10/dist/cdn.min.js" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#050a14">
    <style>
        body, html { font-family: 'Inter', sans-serif; background-color: #050a14; color: #e0e0e0; height: 100%; margin: 0; padding: 0; }
        .app-container[x-data] { height: 100vh; display: flex; flex-direction: column; }
        [x-cloak] { display: none !important; }
        .piece-white { fill: #ffffff; stroke: #333; stroke-width: 1.5; }
        .piece-black { fill: #2c2c2c; stroke: #ccc; stroke-width: 1.5; }
        .splash-screen {
            background-color: #050a14;
            cursor: pointer;
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 9999;
        }
        .main-app-content {
             flex-grow: 1;
             overflow-y: auto;
        }
        /* Tabuleiro com quadrados uniformes */
        #chessboard {
            width: 100%;
            max-width: 500px;
            aspect-ratio: 1 / 1;
            border: 2px solid #333;
        }
        #chessboard > div {
            display: flex;
            aspect-ratio: 1 / 1;
            position: relative;
        }
        #chessboard > div > div {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .notation-file {
            position: absolute;
            bottom: 2px;
            right: 2px;
            font-size: 10px;
            color: rgba(255,255,255,0.5);
        }
        .notation-rank {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 10px;
            color: rgba(255,255,255,0.5);
        }
    </style>
</head>
<body x-data="{showSplash: true}" :class="{'overflow-hidden': showSplash}">
    <!-- SVG Piece Definitions -->
    <svg xmlns="http://www.w3.org/2000/svg" style="display:none">
        <symbol id="pawn" viewBox="0 0 45 45"><g fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><path d="M22.5 11.63V6M20 8h5" stroke-width="1.5" /><path d="M22.5 25c4.418 0 8-3.582 8-8 0-4.418-3.582-8-8-8-4.418 0-8 3.582-8 8 0 4.418 3.582 8 8 8z" stroke-width="1.2" /><path d="M22.5 25c-4.418 0-8 1.5-8 4v2h16v-2c0-2.5-3.582-4-8-4z" stroke-width="1.2" /><path d="M14.5 31v5.5h16V31" /><path d="M11.5 39.5h22" stroke-width="2" /></g></symbol>
        <symbol id="rook" viewBox="0 0 45 45"><g fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><path d="M9 39h27v-3H9v3zM12 36v-4h21v4H12zM11 14V9h4v2h5V9h5v2h5V9h4v5" stroke-width="1.5"/><path d="M34 14l-3 3H14l-3-3" /><path d="M31 17v12.5H14V17" /><path d="M31 29.5l1.5 2.5h-20l1.5-2.5" /><path d="M14 17h17" stroke-width="2.5" /></g></symbol>
        <symbol id="knight" viewBox="0 0 45 45"><g fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10c1.333-1.333 1.333-3.333 0-5 1.333 1.667 2.333 4 .333 6.333-2 2.333-4.333 2-6.333 2 .667-1.333 1.667-3.333 2.667-5.333-1 2-1.667 3.667-2.667 5.333-1.333 0-2.667-1.333-4-4-1.333 2.667-1.333 5.333.667 8 .667 1.333 2 2.333 4 3 .667 2 1.667 4 3 6 2.667 2.667 6.333 3.667 11 3 2.667-2 3.333-4.333 4-7 .667-2.667 0-5-1-7-1-2-2.333-3.667-4-5-1.667-1.333-3.667-2-6-2z" stroke-width="1.5" /><path d="M25 32c-2.667 1.333-5.333 2-8 2-2.667 0-5-1-7-3-1.333-2-2-4.333-2-7 0-2 .667-4 2-6 .667-1.333 1.667-2.333 3-3" stroke-width="1.5" /><path d="M15 39.5s1 1 3 1 4-1 4-1" stroke-width="2"/></g></symbol>
        <symbol id="bishop" viewBox="0 0 45 45"><g fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><path d="M9 39h27v-3H9v3zM15 36v-4h15v4H15zM12 32l4-4h13l4 4H12z" /><path d="M22.5 8c-1.424 0-2.5 2.5-2.5 4.5 0 2 1.076 4.5 2.5 4.5s2.5-2.5 2.5-4.5c0-2-1.076-4.5-2.5-4.5z" /><path d="M22.5 17c-2.5 0-4.5 2-4.5 4.5V26h9v-4.5c0-2.5-2-4.5-4.5-4.5z" /><path d="M18 26h9" stroke-width="2.5" /></g></symbol>
        <symbol id="queen" viewBox="0 0 45 45"><path d="M8 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM17 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM25 9a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM33 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM41 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0z" /><path d="M8 12s2 6 2 8c0 2 1.5 3 1.5 3s1.5-1 1.5-3c0-2 2-8 2-8" /><path d="M17 12s2 6 2 8c0 2 1.5 3 1.5 3s1.5-1 1.5-3c0-2 2-8 2-8" /><path d="M25 9s1 7 1 9c0 2 1.5 3 1.5 3s1.5-1 1.5-3c0-2 1-9 1-9" /><path d="M33 12s2 6 2 8c0 2 1.5 3 1.5 3s1.5-1 1.5-3c0-2 2-8 2-8" /><path d="M9 26c1.5-1 3.5-1.5 6.5-1.5 3 0 5 .5 6.5 1.5" stroke-width="1.2" /><path d="M9 26c0 2 1.5 3 1.5 3s1.5-1 1.5-3c0-2 1-5 1-5" /><path d="M15 21s1 5 1 5c0 2 1.5 3 1.5 3s1.5-1 1.5-3c0 0 1-5 1-5" /><path d="M24 21s1 5 1 5c0 2 1.5 3 1.5 3s1.5-1 1.5-3c0 0 1-5 1-5" /><path d="M30 21s1 5 1 5c0 2 1.5 3 1.5 3s1.5-1 1.5-3c0-2 1-5 1-5" /><path d="M36 26c0 2-1.5 3-1.5 3s-1.5-1-1.5-3c0-2-1-5-1-5" /><path d="M9 39h27v-3H9v3zM12 36v-4h21v4H12z" /><path d="M12 32s1.5-1.5 3-1.5 15 0 15 0 1.5 1.5 3 1.5" stroke-width="1.2" /></symbol>
        <symbol id="king" viewBox="0 0 45 45"><g fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><path d="M22.5 11.5V6M20 8h5" stroke-width="1.5"/><path d="M22.5 25c4.418 0 8-3.582 8-8 0-4.418-3.582-8-8-8-4.418 0-8 3.582-8 8 0 4.418 3.582 8 8 8z" stroke-width="1.2" /><path d="M22.5 25c-4.418 0-8 1.5-8 4v2h16v-2c0-2.5-3.582-4-8-4z" stroke-width="1.2" /><path d="M14.5 31v5.5h16V31" /><path d="M11.5 39.5h22" stroke-width="2" /><path d="M20 8s-1.5-1-1.5-3 1.5-3 1.5-3" /><path d="M25 8s1.5-1 1.5-3-1.5-3-1.5-3" /></g></symbol>
    </svg>

    <div x-data="chessClub()" x-init="init()" class="app-container" x-cloak>
        <!-- Splash Screen -->
        <div x-show="showSplash" @click="showSplash = false" class="splash-screen fixed inset-0 z-50 flex flex-col items-center justify-center transition-opacity duration-500" :class="{'opacity-0 pointer-events-none': !showSplash}">
            <div class="text-3xl font-bold mb-4">Chess Club</div>
            <div class="text-sm">Clique para iniciar</div>
        </div>

        <div class="main-app-content p-4" :class="{'hidden': showSplash}">
            <!-- Tabs -->
            <div class="flex space-x-4 mb-4 border-b border-gray-700">
                <button @click="activeTab = 'attendance'" :class="{'text-white border-b-2 border-blue-500': activeTab === 'attendance'}" class="pb-2">Presença</button>
                <button @click="activeTab = 'ranking'" :class="{'text-white border-b-2 border-blue-500': activeTab === 'ranking'}" class="pb-2">Ranking</button>
                <button @click="activeTab = 'tournaments'" :class="{'text-white border-b-2 border-blue-500': activeTab === 'tournaments'}" class="pb-2">Torneios</button>
                <button @click="activeTab = 'play'" :class="{'text-white border-b-2 border-blue-500': activeTab === 'play'}" class="pb-2">Jogar</button>
            </div>

            <!-- Presença -->
            <div x-show="activeTab === 'attendance'" class="space-y-4">
                <h2 class="text-xl font-bold">Turmas</h2>
                <template x-for="turma in turmas" :key="turma.codigo">
                    <div class="bg-gray-900 p-3 rounded">
                        <h3 class="font-bold mb-2" x-text="turma.nome"></h3>
                        <button @click="abrirPresenca(turma)" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-1 rounded">Lançar Presença</button>
                    </div>
                </template>
            </div>

            <!-- Modal Presença -->
            <div x-show="modalPresenca" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                <div class="bg-gray-900 p-4 rounded max-w-lg w-full max-h-[90vh] overflow-y-auto">
                    <h3 class="text-xl font-bold mb-2" x-text="turmaAtual?.nome"></h3>
                    <div class="mb-2">
                        <label class="block mb-1 text-sm">Data:</label>
                        <input type="date" x-model="dataPresenca" class="bg-gray-800 text-white p-2 rounded w-full text-sm">
                    </div>
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b border-gray-700">
                                <th class="p-2 text-left">Aluno</th>
                                <th class="p-2 text-center">P</th>
                                <th class="p-2 text-center">F</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="aluno in turmaAtual?.alunos" :key="aluno">
                                <tr class="border-b border-gray-800">
                                    <td class="p-2" x-text="aluno"></td>
                                    <td class="p-2 text-center">
                                        <input type="radio" :name="'status-'+aluno" :value="'P'" 
                                            :checked="getStatus(aluno) === 'P'"
                                            @click="setStatus(aluno, 'P')">
                                    </td>
                                    <td class="p-2 text-center">
                                        <input type="radio" :name="'status-'+aluno" :value="'F'" 
                                            :checked="getStatus(aluno) === 'F'"
                                            @click="setStatus(aluno, 'F')">
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                    <div class="mt-3 flex justify-end space-x-2">
                        <button @click="salvarPresenca" class="bg-green-600 hover:bg-green-700 text-white py-1 px-3 rounded text-sm">Salvar</button>
                        <button @click="modalPresenca = false" class="bg-gray-600 hover:bg-gray-700 text-white py-1 px-3 rounded text-sm">Fechar</button>
                    </div>
                </div>
            </div>

            <!-- Ranking -->
            <div x-show="activeTab === 'ranking'" class="space-y-2">
                <h2 class="text-xl font-bold mb-2">Ranking de Alunos</h2>
                <div class="bg-gray-900 rounded max-h-96 overflow-y-auto">
                    <table class="w-full text-sm">
                        <thead class="sticky top-0 bg-gray-800">
                            <tr>
                                <th class="p-2 text-left">#</th>
                                <th class="p-2 text-left">Nome</th>
                                <th class="p-2 text-right">V</th>
                                <th class="p-2 text-right">E</th>
                                <th class="p-2 text-right">D</th>
                                <th class="p-2 text-right">Pts</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template x-for="(player, index) in rankedPlayers" :key="player.id">
                                <tr class="border-b border-gray-800 hover:bg-gray-850">
                                    <td class="p-2" x-text="index + 1"></td>
                                    <td class="p-2" x-text="player.name"></td>
                                    <td class="p-2 text-right" x-text="player.wins"></td>
                                    <td class="p-2 text-right" x-text="player.draws"></td>
                                    <td class="p-2 text-right" x-text="player.losses"></td>
                                    <td class="p-2 text-right" x-text="player.points.toFixed(1)"></td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Torneios -->
            <div x-show="activeTab === 'tournaments'" class="space-y-4">
                <